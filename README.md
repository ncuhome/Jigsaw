# è®¸å¤šäººå¯ä»¥ä¸€èµ·ç©çš„æ‹¼å›¾æ¸¸æˆ(Let's Pin)

## é¡¹ç›®åœ°å€

[éƒ¨ç½²åœ°å€](https://pin.ncuos.com)

[åç«¯é¡¹ç›®åœ°å€](https://github.com/Jinof/Jigsaw-be/tree/fix/refactor)

## ç›®å‰è¿›åº¦

**ğŸ“– å‰ç«¯æ”¹é€ **

+ [x] æ¸¸æˆå…¬æµ‹
+ [x] æ¸¸æˆåˆ†æ•°æ•°è®¾ç½® (backEnd)
+ [x] è‡ªåŠ¨åŒ– CI
+ [x] react-loadable æ›¿æ¢ä¸º Suspense
+ [x] store å±‚æ”¹é€ 
+ [x] å‰ç«¯è®¤è¯æ¨¡å¼æ”¹é€ 
+ [x] é›†æˆ snowpack
+ [x] ä¼˜åŒ–å›¾ç‰‡å¼•å…¥ï¼ˆåˆ‡ç‰‡ç§»åŠ¨æ—¶æœ‰å¤šä½™çš„ç½‘ç»œè¯·æ±‚ï¼Œè€ƒè™‘ prefetch åè½¬ base64ï¼‰
+ [x] é›†æˆ Typescript
+ [ ] socket å¼•å…¥æ¨¡å¼æ”¹é€ ä¸º Context
+ [ ] mincu æ¥å…¥


**ğŸ‘·â€â™€ï¸ æ•´ä½“æ”¹é€ **

+ [ ] å¢é‡æ›´æ–° & ç‰ˆæœ¬æ§åˆ¶
+ [ ] è‡ªå®šä¹‰æˆ¿é—´åˆ—è¡¨
+ [ ] åŒ¹é…æ¨¡å¼

## å¼€å‘ç¯å¢ƒè°ƒè¯•

å‰ç«¯æœåŠ¡
```
yarn start
```
è¿›å…¥`localhost:8080`è¿›è¡Œè°ƒè¯•


## åŸºæœ¬æµç¨‹

### ç™»å½•

è¾“å…¥å¯†ç ä¸å­¦å·ï¼ˆäº‘å®¶å›­ï¼‰

### é¦–é¡µ

1. åˆ›å»ºæˆ¿é—´ -> è¾“å…¥é˜Ÿä¼å(ä¸é‡å¤) -> é€‰æ‹©äººæ•°ï¼ˆéš¾åº¦ -> ç”Ÿæˆé˜Ÿä¼åºå· -> å‡†å¤‡æ¸¸æˆ -> å¼€å§‹æ¸¸æˆ(éšæœºç»™å›¾ç‰‡)

2. åŠ å…¥æˆ¿é—´ -> è¾“å…¥æˆ¿é—´å· -> äººæ»¡ ? æç¤ºæˆ¿é—´å·²æ»¡ : (è¿›å…¥æˆ¿é—´ -> å·²ç»å¼€å§‹æ¸¸æˆ ? ç›´æ¥åŠ å…¥æ¸¸æˆ : å‡†å¤‡æ¸¸æˆ )

3. æŸ¥çœ‹æ’è¡Œ ->ï¼ˆtodoï¼‰

## æ‹¼å›¾é€»è¾‘

### å€’è®¡æ—¶

å½“é˜Ÿä¼è¶³å¤Ÿè¯¥éš¾åº¦äººæ•°æ—¶ æ¸¸æˆå€’è®¡æ—¶å¼€å§‹

### æ‹¼å›¾è®¾ç½®

è®¾å®šäº†ä¸‰ä¸ªéš¾åº¦ ä»¥ä¾¿äºèƒ½å¤Ÿè®©æ‰€æœ‰äººéƒ½è¿›è¡Œæ¸¸æˆ

| éš¾åº¦ | äººæ•° | æ‹¼å›¾ | åˆ†æ•°è®¾ç½® | ç©å®¶æ‰‹æŒåˆ‡ç‰‡æ•°
| --- | --- | ---| --- | --- |
| easy(3) | 3äºº | 3x3 | (over/time)*3 | 3ä¸ª
| normal(4) | 4äºº | 4x4 | (over/time)*4 | 4ä¸ª
| hard(5) | 5äºº | 5x5 | (over/time)*5 | 5ä¸ª

> overä¸ºè¯„ä»·å®Œæˆåº¦çš„æ•°å€¼


### å‰åé€šä¿¡websocketéƒ¨åˆ†

æ¯æ¬¡æœ‰äººè¿›å…¥æˆ¿é—´æ—¶ï¼Œå‘è¯¥äººå‘é€

```json
{
  "roomName": "F4",         //é˜Ÿä¼å
  "roomId": 114512,         //æˆ¿é—´å·
  "members": [              //è¯¥æˆ¿é—´ç”¨æˆ·ä¿¡æ¯
      {
          "username": "è”¡å¾å¤",     //ç”¨æˆ·å
          "identity": "leader",    //ç”¨æˆ·èº«ä»½
          "id": 1                  //ç”¨æ¥æ ‡ç¤ºå…¶åœ¨æˆ¿é—´å†…çš„åºå·
      },
      {
          "username": "å´äº¦å‡¡",
          "identity": "member",
          "id": 2
      },
      {
          "username": "ç‹æº",
          "identity": "member",
          "id": 3
      },
      {
          "username": "èµµå­ç¦",
          "identity": "member",
          "id": 4
      }
  ]
}
```
å‘æˆ¿é—´å†…å…¶ä»–äººå‘é€
```json
{
  "message": "xxxåŠ å…¥æˆ¿é—´",
  "members": [              //è¯¥æˆ¿é—´ç”¨æˆ·ä¿¡æ¯
      {
          "username": "è”¡å¾å¤",     //ç”¨æˆ·å
          "identity": "leader",    //ç”¨æˆ·èº«ä»½
          "id": 1                  //ç”¨æ¥æ ‡ç¤ºå…¶åœ¨æˆ¿é—´å†…çš„åºå·
      },
      {
          "username": "å´äº¦å‡¡",
          "identity": "member",
          "id": 2
      },
      {
          "username": "ç‹æº",
          "dentity": "member",
          "id": 3
      },
      {
          "username": "èµµå­ç¦",
          "identity": "member",
          "id": 4
      }
  ]
}
```
leaderå¼€å§‹æ¸¸æˆæ—¶
```json
{
    "members": [              //è¯¥æˆ¿é—´ç”¨æˆ·ä¿¡æ¯
      {
          "username": "è”¡å¾å¤",     //ç”¨æˆ·å
          "identity": "leader",    //ç”¨æˆ·èº«ä»½
          "id": 1                  //ç”¨æ¥æ ‡ç¤ºå…¶åœ¨æˆ¿é—´å†…çš„åºå·
      },
      {
          "username": "å´äº¦å‡¡",
          "identity": "member",
          "id": 2
      },
      {
          "username": "ç‹æº",
          "dentity": "member",
          "id": 3
      },
      {
          "username": "èµµå­ç¦",
          "identity": "member",
          "id": 4
      }
    "starTime": 
}
```
æˆ¿é—´å†…æ‰€æœ‰æˆå‘˜æ¥æ”¶
```json
{
  "username": "èµµå­ç¦",      //ç”¨æˆ·å
  "roomName": "F4",         //é˜Ÿä¼å
  "roomId": 114512,         //æˆ¿é—´å·
  "picKind": 2,             //é€‰å›¾
  "difficult": 4,           //éš¾åº¦
  "jigsawList": [           //è¯¥æˆ¿é—´æ­¤æ—¶çš„æ¸¸æˆè¿›ç¨‹
      [0, 2, 3, 0],
      [0, 6, 0, 8],
      [9, 10, 11, 12],
      [13, 14, 15, 16]
  ],
  "pics": [1, 4, 5, 7],     //è¯¥ç”¨æˆ·å¯æ“ä½œçš„å¡ç‰‡
  "endTime": 1234123,
  "members": [              //è¯¥æˆ¿é—´ç”¨æˆ·ä¿¡æ¯
      {
          "username": "è”¡å¾å¤",     //ç”¨æˆ·å
          "identity": "leader",    //ç”¨æˆ·èº«ä»½
          "id": 1                  //ç”¨æ¥æ ‡ç¤ºå…¶åœ¨æˆ¿é—´å†…çš„åºå·
      },
      {
          "username": "å´äº¦å‡¡",
          "identity": "member",
          "id": 2
      },
      {
          "username": "ç‹æº",
          "dentity": "member",
          "id": 3
      },
      {
          "username": "èµµå­ç¦",
          "identity": "member",
          "id": 4
      }
  ]
}
```
æ¯æ¬¡æœ‰äººåŠ å…¥æ¸¸æˆæ—¶ï¼Œå‘è¯¥äººå‘é€ï¼ˆæ ¹æ®`token`è¿”å›ï¼‰
```json
{
  "username": "èµµå­ç¦",      //ç”¨æˆ·å
  "roomName": "F4",         //é˜Ÿä¼å
  "roomId": 114512,         //æˆ¿é—´å·
  "picKind": 2,             //é€‰å›¾
  "difficult": 4,           //éš¾åº¦
  "jigsawList": [           //è¯¥æˆ¿é—´æ­¤æ—¶çš„æ¸¸æˆè¿›ç¨‹
      [0, 2, 3, 0],
      [0, 6, 0, 8],
      [9, 10, 11, 12],
      [13, 14, 15, 16]
  ],
  "pics": [1, 4, 5, 7],     //è¯¥ç”¨æˆ·å¯æ“ä½œçš„å¡ç‰‡
  "endTime": 1234123,
  "members": [              //è¯¥æˆ¿é—´ç”¨æˆ·ä¿¡æ¯
      {
          "username": "è”¡å¾å¤",     //ç”¨æˆ·å
          "identity": "leader",    //ç”¨æˆ·èº«ä»½
          "id": 1                  //ç”¨æ¥æ ‡ç¤ºå…¶åœ¨æˆ¿é—´å†…çš„åºå·
      },
      {
          "username": "å´äº¦å‡¡",
          "identity": "member",
          "id": 2
      },
      {
          "username": "ç‹æº",
          "dentity": "member",
          "id": 3
      },
      {
          "username": "èµµå­ç¦",
          "identity": "member",
          "id": 4
      }
  ]
}
```
å¹¶å‘è¯¥æˆ¿é—´å…¶ä»–äººå¹¿æ’­ (wsä¼šæ ¹æ®å…³é”®å­—å›è°ƒç›¸åº”å‡½æ•°)(æœåŠ¡å™¨ç›‘å¬å¹¶å°†æ­¤äººä»æ•°ç»„ä¸­åŠ å…¥)
```json
{
    "username": "èµµå­ç¦",
    "id": 4 
}
```
ç§»åŠ¨æ‹¼å›¾å å‘è¯¥æˆ¿é—´éå·±æˆå‘˜å¹¿æ’­ å¹¶å°†`list`åºåˆ—åŒ–å­˜å‚¨åœ¨åœ¨redisä¸­
```json
{
    "list": [    
      [0, 2, 3, 4],
      [0, 6, 0, 8],
      [9, 10, 11, 12],
      [13, 14, 15, 16]
    ],
    "handleRow": 0,
    "handleColumn": 3,
    "user": "èµµå­ç¦"
    "members": [              //è¯¥æˆ¿é—´ç”¨æˆ·ä¿¡æ¯
      {
          "username": "è”¡å¾å¤",     //ç”¨æˆ·å
          "identity": "leader",    //ç”¨æˆ·èº«ä»½
          "id": 1                  //ç”¨æ¥æ ‡ç¤ºå…¶åœ¨æˆ¿é—´å†…çš„åºå·
      },
      {
          "username": "å´äº¦å‡¡",
          "identity": "member",
          "id": 2
      },
      {
          "username": "ç‹æº",
          "dentity": "member",
          "id": 3
      },
      {
          "username": "èµµå­ç¦",
          "identity": "member",
          "id": 4
      }
  ]
}
```

æŸäººé€€å‡ºæ¸¸æˆ å‘è¯¥æˆ¿é—´éæŸäººæˆå‘˜å¹¿æ’­ (wsä¼šæ ¹æ®å…³é”®å­—å›è°ƒç›¸åº”å‡½æ•°)(æœåŠ¡å™¨ç›‘å¬å¹¶å°†æ­¤äººä»æ•°ç»„ä¸­åˆ é™¤)
```json
{
    "username": "èµµå­ç¦",
    "id": 4 
}
```

### ç»“æŸæ¸¸æˆ

#### ä¸­é€”é€€å‡º
å‘æ‰€æœ‰äººå¹¿æ’­æ­¤äººé€€å‡ºä¿¡æ¯, æ¸¸æˆç»§ç»­è¿›è¡Œ

#### å› 5åˆ†é’Ÿå€’è®¡æ—¶å·²åˆ°è€Œç»“æŸ
å¼ºè¡Œä¸Šäº¤çŸ©é˜µ/é˜Ÿä¼ä¸æˆ¿é—´ä¿¡æ¯ å¹¶è®¡ç®—å‡ºåˆ†æ•°ï¼ˆtime=300ï¼‰

#### æœªåˆ°5åˆ†é’Ÿ å› ä¸ºæ‹¼å®Œè€Œç»“æŸ
é˜Ÿé•¿æäº¤çŸ©é˜µ/å®Œæˆæ—¶é—´/é˜Ÿä¼ä¸æˆ¿é—´ä¿¡æ¯ å¹¶è®¡ç®—å‡ºåˆ†æ•°

#### åŠ å…¥æˆ¿é—´
è¿”å›çš„data
```
{
  roomName: "ç™½è‰²ç›¸ç°¿",
  roomId: 13321452314,
  members: [
    {
      username: "èƒ¡æ˜Šæ±Ÿ",
      userId: 123,
      identity: "leader",
      class: "ç‰©ç†å­¦ç±» 183ç­",
      ready: false,
      id: 1
    },
    {
      username: "èµµå­ç¦",
      userId: 11,
      identity: "member",
      class: "æ•°å­¦ä¸åº”ç”¨æ•°å­¦ 193ç­",
      ready: false,
      id: 2
    },
    {
      username: "ç”°æ‰¿æ¶µ",
      userId: 13,
      identity: "member",
      class: "ä¿¡æ¯ä¸è®¡ç®—ç§‘å­¦ 181ç­",
      ready: true,
      id: 3
    }
  ],
  message: "èƒ¡æ˜Šæ±ŸåŠ å…¥æœ¬æˆ¿é—´",
  difficult: 4,
};
```